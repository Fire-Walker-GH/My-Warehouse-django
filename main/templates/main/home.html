{% extends 'main/layout.html' %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'main/css/home.css' %}">

{% if request.user.is_authenticated %}
    <h2>–í–∞—à–∏ —Å–∫–ª–∞–¥—ã</h2>
    {% if user_warehouses %}
        <div class="warehouse-block">
            {% for warehouse in user_warehouses %}
                <div class="warehouse-item">
                    <h3 class="warehouse-name">{{ warehouse.name }}</h3>
                    <p class="warehouse-address">{{ warehouse.address }}</p>
                    <p class="warehouse-products-quantity">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤: {{ warehouse.total_quantity|default:"0" }}</p>
                    <p class="warehouse-unique-items-count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–æ–≤ —Ç–æ–≤–∞—Ä–∞: {{ warehouse.unique_item_count|default:"0" }}</p>
                    
                    <div class="warehouse-actions">
                        <a href="{% url 'items_list' warehouse_id=warehouse.id %}" class="open-the-warehouse-bth">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∫–ª–∞–¥</a>
                        <button type="button" class="delete-warehouse-btn" 
                            onclick="openDeleteModal('{{ warehouse.id }}', '{{ warehouse.name }}')">
                            –£–¥–∞–ª–∏—Ç—å —Å–∫–ª–∞–¥
                        </button>
                    </div>
                    
                    <div class="warehouse-secondary-actions">
                        <button type="button" class="share-access-btn" onclick="openShareModal('{{ warehouse.id }}', '{{ warehouse.name }}', '{{ warehouse.shared_count }}')">–°–æ–≤–º–µ—Å—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø</button>
                    </div>
                    <script type="application/json" id="users-data-{{ warehouse.id }}">
                            {{ warehouse.shared_users_json|safe }}
                    </script>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <h2>–£ –≤–∞—Å –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–∫–ª–∞–¥–æ–≤</h2>
        <a href="{% url 'add_warehouse' %}" class="add-warehouse-btn">–î–æ–±–∞–≤–∏—Ç—å</a>
    {% endif %}

    <div class="shared-warehouses-section">
        <h2>–°–æ–≤–º–µ—Å—Ç–Ω—ã–µ —Å–∫–ª–∞–¥—ã</h2>
    </div>

{% else %} 
    <section class="hero">
        <div class="container">
            <h1>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º —Å–∫–ª–∞–¥–æ–º —Å –ª–µ–≥–∫–æ—Å—Ç—å—é</h1>
            <p>–ü—Ä–æ—Å—Ç–∞—è –∏ —É–¥–æ–±–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É—á–µ—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –≤–∞—à–µ–º —Å–∫–ª–∞–¥–µ. –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ –æ—Å—Ç–∞—Ç–∫–∏, –¥–≤–∏–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.</p>
        </div>
    </section>

    <section class="features">
        <div class="container">
            <h2>–ù–∞—à–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <h3>üìä –£—á–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</h3>
                    <p>–í–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π —É—á–µ—Ç –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –≤–∞—à–µ–º —Å–∫–ª–∞–¥–µ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–∞–∂–¥–æ–º –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏.</p>
                </div>
                <div class="feature-card">
                    <h3>üîÑ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–π</h3>
                    <p>–§–∏–∫—Å–∏—Ä—É–π—Ç–µ –≤—Å–µ –ø—Ä–∏—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã —Ç–æ–≤–∞—Ä–æ–≤, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ —Ç–µ–∫—É—â–∏—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤.</p>
                </div>
                <div class="feature-card">
                    <h3>üì± –£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h3>
                    <p>–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∑–≤–æ–ª–∏—Ç –±—ã—Å—Ç—Ä–æ –æ—Å–≤–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∏ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="how-it-works">
        <div class="container">
            <h2>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</h3>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>–î–æ–±–∞–≤—å—Ç–µ —Å–∫–ª–∞–¥</h3>
                    <p>–í–Ω–µ—Å–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—à–µ–º —Å–∫–ª–∞–¥–µ</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–∫–ª–∞–¥–æ–º</h3>
                    <p>–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤</p>
                </div>
            </div>
        </div>
    </section>
{% endif %}


<div id="deleteModal" class="modal-overlay">
        <div class="modal-content">
        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
        <p id="modalText">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–∫–ª–∞–¥?</p>
        
        <div class="modal-buttons">
            <form id="deleteForm" method="POST" action="">
                {% csrf_token %}
                <button type="submit" class="btn-confirm">–î–∞, —É–¥–∞–ª–∏—Ç—å</button>
            </form>
            <button type="button" class="btn-cancel" onclick="closeDeleteModal()">–ù–µ—Ç, –æ—Ç–º–µ–Ω–∞</button>
        </div>
        </div>
</div>

<div id="shareModal" class="modal-overlay">
    <div class="modal-content share-modal-content">
        <h3 id="shareModalTitle">–°–æ–≤–º–µ—Å—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø</h3>
        <div class="share-modal-body">
            <div class="share-users-list">
                <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º: <span id="sharedUsersCount">0</span></h4>
                <ul id="usersList" style="list-style: none; padding: 0; margin-top: 10px;">
                   
                </ul>
            </div>
            <div class="share-actions">
                <button type="button" class="btn-add-user" onclick="openAddUserModal()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
        <div class="modal-buttons">
            <button type="button" class="btn-cancel" onclick="closeShareModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<div id="addUserModal" class="modal-overlay">
    <div class="modal-content">
        <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <form id="addUserForm" class="add-user-form" method="POST" autocomplete="off">
            {% csrf_token %}
            <div class="form-group">
                <label for="userLogin">–õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="userLogin" name="login" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required>
                <div id="userLoginError" style="color: #dc3545; font-size: 0.85em; margin-top: 5px; display: none;"></div>
            </div>
            <div class="form-group">
                <label for="userRole">–†–æ–ª—å:</label>
                <select id="userRole" name="role">
                    <option value="viewer">–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å</option>
                    <option value="editor">–†–µ–¥–∞–∫—Ç–æ—Ä</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button type="submit" class="btn-confirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button type="button" class="btn-cancel" onclick="closeAddUserModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

<script src="{% static 'main/js/home.js' %}"></script>

{% endblock %}

